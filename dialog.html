<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <style>
      body {
        padding: 1rem;
      }
      .btn-block {
        margin-top: 0.75rem;
      }
      h5 {
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      
      <h5>Escolha o Cabeçalho</h5>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="headerRadio" id="header-none" value="" checked>
        <label class="form-check-label" for="header-none">
          Nenhum
        </label>
      </div>

      <? for (var i = 0; i < images.headers.length; i++) { ?>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="headerRadio" id="header-<?= i ?>" value="<?= images.headers[i].id ?>">
          <label class="form-check-label" for="header-<?= i ?>">
            <?= images.headers[i].name ?>
          </label>
        </div>
      <? } ?>
      
      <h5 class="mt-3">Escolha o Rodapé</h5>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="footerRadio" id="footer-none" value="" checked>
        <label class="form-check-label" for="footer-none">
          Nenhum
        </label>
      </div>

      <? for (var i = 0; i < images.footers.length; i++) { ?>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="footerRadio" id="footer-<?= i ?>" value="<?= images.footers[i].id ?>">
          <label class="form-check-label" for="footer-<?= i ?>">
            <?= images.footers[i].name ?>
          </label>
        </div>
      <? } ?>

      <button class="btn btn-primary btn-block" id="applyBtn" onclick="submitSelection();">
        Aplicar Seleção
      </button>
      <button class="btn btn-secondary btn-block" onclick="google.script.host.close();">
        Cancelar
      </button>
      
    </div>

    <script>
      /**
       * Etapa 3: Captura a escolha do usuário e envia para o servidor.
       */
      function submitSelection() {
        // Desabilita o botão para prevenir cliques múltiplos
        document.getElementById('applyBtn').disabled = true;
        document.getElementById('applyBtn').textContent = 'Aplicando...';

        // Coleta os IDs selecionados
        const selectedHeaderId = document.querySelector('input[name="headerRadio"]:checked').value;
        const selectedFooterId = document.querySelector('input[name="footerRadio"]:checked').value;

        const selection = {
          headerId: selectedHeaderId,
          footerId: selectedFooterId
        };

        // Envia os dados para a função do lado do servidor e fecha a caixa de diálogo ao concluir
        google.script.run
          .withSuccessHandler(google.script.host.close)
          .withFailureHandler(function(error) {
            alert('Falha ao aplicar: ' + error.message);
            google.script.host.close();
          })
          .applyHeaderAndFooter(selection);
      }
    </script>
  </body>
</html>