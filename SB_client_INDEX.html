<script>
    // Valor inicial de pesquisa passado do server-side
    const initialSearchInput = '<?= initialSearchInput ?>';
    
    // Dados pré-carregados do servidor (Etapa 2: Busca de Dados já concluída)
    const preloadedData = <?!= preloadedData || '{}' ?>;
</script>
  
  <!doctype html>
  <html lang="en">
  
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <!-- Bootstrap CSS 5.3.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
    <!-- Inclua o CSS do Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  
    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
  
    <!--includeServerSide CSS FILE-->
    <?!= includeServerSide('SB_client_CSS'); ?> 
  
    <script>
    </script>
  </head>
  
  <body>
  
    <!--LOADING SPINNER-->
    <div id="loading" class="d-flex justify-content-center align-items-center">
      <div class="text-center">
        <div class="spinner-border" role="status">
        </div>
      </div>
    </div>
  
    <!--CONTAINER-->
    <div class="container" id="global">
  
      <!--FILTER BUTTONS-->
      <div class="btn-toolbar d-flex justify-content-center" role="toolbar">
        <div class="btn-group mr-2" role="group" id="filter" style="margin-bottom:1rem;">
          <!-- Botões serão adicionados dinamicamente aqui -->
        </div>
      </div>

      <!--SEARCH INPUT-->
      <div class="input-group input-group-sm mb-3" style="margin-top: 1rem;">
        <input id="searchInputId" type="text" class="form-control" aria-label="Sizing example input"
          aria-describedby="button-clear-input">
        <div class="input-group-append">
          <button class="btn btn-outline-secondary clear" type="button" id="button-clear-input">x</button>
        </div>
      </div>
  
      <!-- PRIMEIRA LISTA SORTABLE (Topo) -->
      <div class="sortable-container d-flex justify-content-center">
        <ul id="topList" class="sortable-list list-group cursor-crosshair">
          <!-- Resultados da busca serão inseridos aqui -->
        </ul>
      </div>
  
      <!-- SEGUNDA LISTA SORTABLE (Base) -->
      <div class="sortable-container d-flex justify-content-center">
        <ul id="listBotton" class="sortable-list list-group cursor-move">
          <!-- Inicia vazio -->
        </ul>
      </div>
  
    </div>
  
    <!--FORMAT BUTTONS FIXED TO FOOTER-->
    <div class="fixed-footer">

      
      <!-- GRID DE BOTÕES NO RODAPÉ -->
      <div class="row g-2 mt-2">
        <div class="col-6">
          <button id="btn-append" type="button" class="btn btn-lg w-100 h-100 btn-primary">
            <i class="bi bi-plus-circle"></i>
          </button>
        </div>
        <div class="col-6">
          <button id="btn-cursor-text" type="button" class="btn btn-lg w-100 h-100"  style="background-color: white; color: black; border: 2px solid #dee2e6;">
            <i class="bi bi-cursor-text"></i>
          </button>
        </div>
        <div class="col-6">
          <button id="btn-brush" type="button" class="btn btn-lg w-100 h-100 btn-danger">
            <i class="bi bi-brush"></i>
          </button>
        </div>
        <div class="col-6">
          <button id="btn-magic" type="button" class="btn btn-lg w-100 h-100" style="background-color: #6f42c1; color: white; border: 2px solid #6f42c1;">
            <i class="bi bi-magic"></i>
          </button>
        </div>
      </div>
    </div>
  
    <!-- TEMPLATE FILTER BUTTONS-->
    <template id="filter-button">
      <button type="button" class="btn btn-sm filter">Primary</button>
    </template>
  
    <!-- TEMPLATE LIST ITEM -->
    <template id="template-list-item">
      <li class="list-group-item list-group-item-action">
        <span class="item-title" style="font-size: 14px;"></span>
      </li>
    </template>
  
    <!--includeServerSide JS FILES-->
    <?!= includeServerSide('SB_client_APPLICATIONSTATE'); ?>
    <?!= includeServerSide('SB_client_EVENTS'); ?>
    <?!= includeServerSide('SB_client_UTILS'); ?>
    <?!= includeServerSide('SB_client_ACTIONHANDLER'); ?>
  
    <script>
      // Inicialização da sidebar quando o DOM estiver pronto
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof initializeSidebar === 'function') {
          initializeSidebar().then(() => {
            // Configura todos os event listeners após a inicialização
            if (typeof setupAllEventListeners === 'function') {
              setupAllEventListeners();
            } else {
              console.error('❌ Função setupAllEventListeners não encontrada');
            }
            
            // Programmatically set focus to the search input
            const searchInput = document.getElementById('searchInputId');
            if (searchInput) {
              searchInput.focus();
            }
            
            // Event listeners para os botões do grid
            document.getElementById('btn-append').addEventListener('click', function() {
              actionHandler.handleBtnAppendClick();
            });
            
            document.getElementById('btn-cursor-text').addEventListener('click', function() {
              actionHandler.handleBtnCursorTextClick();
            });
            
            document.getElementById('btn-brush').addEventListener('click', function() {
              actionHandler.handleBtnBrushClick();
            });
            
            document.getElementById('btn-magic').addEventListener('click', function() {
              actionHandler.handleBtnMagicClick();
            });

          }).catch(error => {
            console.error('❌ Erro na inicialização da sidebar:', error);
          });
        } else {
          console.error('❌ Função initializeSidebar não encontrada');
        }
      });
    </script>
  
    <!-- Bootstrap JS 5.3.3 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
  </body>
  
  </html>
  